<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ã“ã¡ã‚ƒã‚“ã®ãŠã‚„ã¤ã‚²ãƒ¼ãƒ </title>
<style>
  body {
    margin: 0;
    text-align: center;
    background: #fff8f0;
    font-family: Arial, sans-serif;
  }
  h1 {
    font-size: 40px;
    color: #ff6f91;
  }
  #message {
    font-size: 60px;
    color: gold;
    display: none;
    animation: sparkle 1s infinite;
  }
  @keyframes sparkle {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }
  #game {
    display: flex;
    justify-content: center;
  }
  canvas {
    border: 4px solid #ffb703;
    background: #fff;
  }
</style>
</head>
<body>

<h1>ğŸ° ã‚ã“ã¡ã‚ƒã‚“ã®ãŠã‚„ã¤ã‚²ãƒ¼ãƒ  ğŸ“</h1>

<div id="score">ã‚¹ã‚³ã‚¢: 0</div>
<div id="next">æ¬¡ã®ãŠã‚„ã¤ï¼š<img id="nextImg" width="40"></div>

<div id="message">ğŸ‰ ãŠã‚ã§ã¨ã†ï¼ ğŸ‰</div>
<div id="game"></div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const { Engine, Render, World, Bodies, Events } = Matter;

const engine = Engine.create();
engine.world.gravity.y = 0.4;

let score = 0;
let nextLevel = 0; // æ¬¡ã«è½ã¡ã¦ãã‚‹ãŠã‚„ã¤ã®ãƒ¬ãƒ™ãƒ«

// Canvas ã‚’ #game ã®ä¸­ã«æç”»
const render = Render.create({
  element: document.getElementById("game"),
  engine: engine,
  options: {
    width: 400,
    height: 600,
    wireframes: false
  }
});

// åœ°é¢
const ground = Bodies.rectangle(200, 590, 400, 20, { isStatic: true });
World.add(engine.world, ground);

// GitHub ã®å®Ÿãƒ•ã‚¡ã‚¤ãƒ«åã«å®Œå…¨ä¸€è‡´ã•ã›ãŸç”»åƒãƒªã‚¹ãƒˆï¼ˆé€²åŒ–é †ï¼‰
const snackImages = [
  "strawberry.png.png",   // 0 ã‚¤ãƒã‚´
  "blueberry.png.png",    // 1 ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼
  "whip.png.png",         // 2 ãƒ›ã‚¤ãƒƒãƒ—
  "cookie.png.png",       // 3 ã‚¯ãƒƒã‚­ãƒ¼
  "cheesecake.png.png"    // 4 ãƒãƒ¼ã‚ºã‚±ãƒ¼ã‚­
];

// ãƒ¬ãƒ™ãƒ«ã”ã¨ã®å¤§ãã•ï¼ˆã‚¹ã‚¤ã‚«ã‚²ãƒ¼ãƒ é¢¨ï¼‰
const snackScale = [
  0.20, // strawberry
  0.15, // blueberry
  0.30, // whip
  0.45, // cookie
  0.60  // cheesecake
];

// ãŠã‚„ã¤ç”Ÿæˆï¼ˆã‚µã‚¤ã‚ºåæ˜ ç‰ˆï¼‰
function createSnack(x, level = 0) {
  const scale = snackScale[level];

  // å…ƒç”»åƒã®ã‚µã‚¤ã‚ºï¼ˆã‚ãªãŸã®ç”»åƒã«åˆã‚ã›ã¦èª¿æ•´ï¼‰
  const baseSize = 35;
  const size = baseSize * scale;

const snack = Bodies.rectangle(x, 40, size, size, {
  label: "snack",
  level: level,
  friction: 0.9,        // æ‘©æ“¦ã‚’å¼·ãã™ã‚‹ â†’ æ»‘ã‚‰ãªã„
  frictionStatic: 1.0,  // é™æ­¢æ‘©æ“¦ã‚’å¼·ãã™ã‚‹ â†’ æ­¢ã¾ã‚Šã‚„ã™ã„
  restitution: 0.0,     // åç™ºã‚’ã‚¼ãƒ­ã«ã™ã‚‹ â†’ è·³ã­ãªã„
  render: {
    sprite: {
      texture: snackImages[level],
      xScale: scale,
      yScale: scale
    }
  }
});


// ã‚¯ãƒªãƒƒã‚¯ã§è½ã¨ã™
document.addEventListener("click", e => {
  const rect = render.canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  World.add(engine.world, createSnack(x));
});

// åˆä½“å‡¦ç†
Events.on(engine, "collisionStart", event => {
  event.pairs.forEach(pair => {
    const a = pair.bodyA;
    const b = pair.bodyB;

    if (a.label === "snack" && b.label === "snack" && a.level === b.level) {
      if (a.level === snackImages.length - 1) return;

      World.remove(engine.world, [a, b]);

      const next = createSnack(
        (a.position.x + b.position.x) / 2,
        a.level + 1
      );
      World.add(engine.world, next);

      // æœ€çµ‚ãƒ¬ãƒ™ãƒ«ã§ãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      if (next.level === snackImages.length - 1) {
        document.getElementById("message").style.display = "block";
      }
    }
  });
});

Engine.run(engine);
Render.run(render);
</script>

</body>
</html>
